<!DOCTYPE html>
<html>
<head>
    <title id="title">AI ASSISTANT</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f0f0f0; transition: all 0.3s; }
        .dark { background: #000; color: #0f0; }
        #chat { height: 400px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: white; }
        #input { width: 80%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 5px; }
        button:hover { background: #0056b3; }
        .mode { font-weight: bold; font-size: 18px; margin-bottom: 10px; color: #333; }
        .dark .mode { color: #0f0; }
        .user-msg { text-align: right; background: #e3f2fd; padding: 8px; margin: 5px 0; border-radius: 4px; }
        .ai-msg { text-align: left; background: #f5f5f5; padding: 8px; margin: 5px 0; border-radius: 4px; }
        .dark .ai-msg { background: #1a1a1a; }
    </style>
</head>
<body>
    <h1>Matrix Core AI Assistant</h1>
    <div id="status" class="mode">Mode: ASSISTANT</div>
    <div id="chat"></div>
    <input id="input" placeholder="Type message (say 'matrix' to switch modes)" autofocus>
    <button onclick="send()">Send</button>
    
    <script>
        const API_URL = 'http://localhost:8000/chat';
        const SESSION_ID = 'user-' + Math.random().toString(36).substr(2, 9);
        let mode = 'assistant';
        
        function addMessage(msg, isUser) {
            const chat = document.getElementById('chat');
            const msgClass = isUser ? 'user-msg' : 'ai-msg';
            chat.innerHTML += `<div class="${msgClass}">${msg}</div>`;
            chat.scrollTop = chat.scrollHeight;
        }
        
        async function send() {
            const input = document.getElementById('input');
            const msg = input.value.trim();
            if (!msg) return;
            addMessage(msg, true);
            input.value = '';
            
            try {
                const resp = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': 'test-normal-key',
                        'x-session-id': SESSION_ID
                    },
                    body: JSON.stringify({message: msg})
                });
                const data = await resp.json();
                addMessage(data.reply, false);
                updateMode(data.mode);
            } catch (err) {
                addMessage('Error: ' + err.message, false);
            }
        }
        
        function updateMode(newMode) {
            mode = newMode;
            const isMatrix = newMode === 'matrix';
            document.getElementById('status').textContent = 'Mode: ' + newMode.toUpperCase();
            document.body.className = isMatrix ? 'dark' : '';
            document.getElementById('title').textContent = isMatrix ? 'MATRIX CORE' : 'AI ASSISTANT';
        }
        
        document.getElementById('input').addEventListener('keypress', e => { 
            if (e.key === 'Enter') send(); 
        });
    </script>
</body>
</html>
